/*
 * Copyright 2014 Artem Khvastunov
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and limitations under the License.
 */
package org.pitest.mutationtest.engine.gregor;

import org.pitest.functional.F;
import org.pitest.functional.FCollection;
import org.pitest.mutationtest.engine.MutationDetails;

import java.util.Collection;

/**
 * The class is intended to exclude mutations that related to auto generated finally block.
 *
 * @author Artem Khvastunov &lt;contact@artspb.me&gt;
 */
public class TryWithResourcesFilter {

    /**
     * The method is intended to exclude mutations that related to auto generated finally block.
     * The context is used to check whether mutation relates to auto generated finally block or not.
     *
     * @param context   to check whether mutation relates to auto generated finally block or not
     * @param mutations to filter
     * @return filtered collection of mutations
     */
    public Collection<MutationDetails> filter(final Context context, final Collection<MutationDetails> mutations) {
        return FCollection.filter(mutations, excludeMutationsOfAutoGeneratedFinallyBlock(context));
    }

    private F<MutationDetails, Boolean> excludeMutationsOfAutoGeneratedFinallyBlock(final Context context) {
        return new F<MutationDetails, Boolean>() {
            public Boolean apply(MutationDetails mutationDetails) {
                // TODO think about checking mutator type here
                return !context.isLineRelatedToAutoGeneratedFinallyBlock(mutationDetails.getLineNumber());
            }
        };
    }
}
